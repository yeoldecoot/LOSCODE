import{_ as jt,b as Ft,e as Ut,c as Kt,C as H,S as g,T as zt,d as qt,f as T,G as ht,g as $t,R as rt,P as d}from"./pixijs-Dvmqejlc.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();async function Qt(o){var t;const e={importPixi:!1,...o};e.app&&(e.renderer=e.app.renderer,e.stage=e.app.stage),e.importPixi&&!e.pixi&&(e.pixi=await jt(()=>import("./pixijs-Dvmqejlc.js").then(s=>s.t),[],import.meta.url)),window.__PIXI_DEVTOOLS__={...window.__PIXI_DEVTOOLS__||{},app:e.app,stage:e.stage,renderer:e.renderer,extensions:[...((t=window.__PIXI_DEVTOOLS__)==null?void 0:t.extensions)||[],...e.extensions||[]],plugins:{}}}const w=new Ft;Qt({app:w});await w.init({background:"#FFFFFF",resizeTo:window,backgroundAlpha:0,antialias:!0,autoDensity:!0,resolution:window.devicePixelRatio});Ut.add(Kt);const Z=new H;Z.cullable=!0;Z.cullableChildren=!0;var pt={},D={},bt;function B(){if(bt)return D;bt=1,Object.defineProperty(D,"__esModule",{value:!0}),D.Collector=void 0;let o=class{constructor(e){this.emit=(...s)=>{e.emitCollecting(this,s)}}};return D.Collector=o,D}var A={},Ct;function Zt(){if(Ct)return A;Ct=1,Object.defineProperty(A,"__esModule",{value:!0}),A.CollectorArray=void 0;const o=B();let t=class extends o.Collector{constructor(){super(...arguments),this.result=[]}handleResult(s){return this.result.push(s),!0}getResult(){return this.result}reset(){this.result.length=0}};return A.CollectorArray=t,A}var R={},Wt;function Bt(){if(Wt)return R;Wt=1,Object.defineProperty(R,"__esModule",{value:!0}),R.CollectorLast=void 0;const o=B();let t=class extends o.Collector{handleResult(s){return this.result=s,!0}getResult(){return this.result}reset(){delete this.result}};return R.CollectorLast=t,R}var N={},Pt;function Gt(){if(Pt)return N;Pt=1,Object.defineProperty(N,"__esModule",{value:!0}),N.CollectorUntil0=void 0;const o=B();let t=class extends o.Collector{constructor(){super(...arguments),this.result=!1}handleResult(s){return this.result=s,this.result}getResult(){return this.result}reset(){this.result=!1}};return N.CollectorUntil0=t,N}var j={},Mt;function Jt(){if(Mt)return j;Mt=1,Object.defineProperty(j,"__esModule",{value:!0}),j.CollectorWhile0=void 0;const o=B();let t=class extends o.Collector{constructor(){super(...arguments),this.result=!1}handleResult(s){return this.result=s,!this.result}getResult(){return this.result}reset(){this.result=!1}};return j.CollectorWhile0=t,j}var F={},U={},St;function te(){if(St)return U;St=1,Object.defineProperty(U,"__esModule",{value:!0}),U.SignalConnectionImpl=void 0;class o{constructor(e,s){this.link=e,this.parentCleanup=s}disconnect(){return this.link!==null?(this.link.unlink(),this.link=null,this.parentCleanup(),this.parentCleanup=null,!0):!1}set enabled(e){this.link&&this.link.setEnabled(e)}get enabled(){return this.link!==null&&this.link.isEnabled()}}return U.SignalConnectionImpl=o,U}var K={},kt;function ee(){if(kt)return K;kt=1,Object.defineProperty(K,"__esModule",{value:!0}),K.SignalLink=void 0;let o=class Yt{constructor(e=null,s=null,i=0){this.enabled=!0,this.newLink=!1,this.callback=null,this.prev=e??this,this.next=s??this,this.order=i}isEnabled(){return this.enabled&&!this.newLink}setEnabled(e){this.enabled=e}unlink(){this.callback=null,this.next.prev=this.prev,this.prev.next=this.next}insert(e,s){let i=this.prev;for(;i!==this&&!(i.order<=s);)i=i.prev;const n=new Yt(i,i.next,s);return n.callback=e,i.next=n,n.next.prev=n,n}};return K.SignalLink=o,K}var Ht;function ie(){if(Ht)return F;Ht=1,Object.defineProperty(F,"__esModule",{value:!0}),F.Signal=void 0;const o=te(),t=ee();let e=class{constructor(){this.head=new t.SignalLink,this.hasNewLinks=!1,this.emitDepth=0,this.connectionsCount=0}getConnectionsCount(){return this.connectionsCount}hasConnections(){return this.connectionsCount>0}connect(i,n=0){this.connectionsCount++;const r=this.head.insert(i,n);return this.emitDepth>0&&(this.hasNewLinks=!0,r.newLink=!0),new o.SignalConnectionImpl(r,()=>this.decrementConnectionCount())}decrementConnectionCount(){this.connectionsCount--}disconnect(i){for(let n=this.head.next;n!==this.head;n=n.next)if(n.callback===i)return this.decrementConnectionCount(),n.unlink(),!0;return!1}disconnectAll(){for(;this.head.next!==this.head;)this.head.next.unlink();this.connectionsCount=0}emit(...i){this.emitDepth++;for(let n=this.head.next;n!==this.head;n=n.next)n.isEnabled()&&n.callback&&n.callback.apply(null,i);this.emitDepth--,this.unsetNewLink()}emitCollecting(i,n){this.emitDepth++;for(let r=this.head.next;r!==this.head;r=r.next)if(r.isEnabled()&&r.callback){const h=r.callback.apply(null,n);if(!i.handleResult(h))break}this.emitDepth--,this.unsetNewLink()}unsetNewLink(){if(this.hasNewLinks&&this.emitDepth===0){for(let i=this.head.next;i!==this.head;i=i.next)i.newLink=!1;this.hasNewLinks=!1}}};return F.Signal=e,F}var $={},Ot;function se(){if(Ot)return $;Ot=1,Object.defineProperty($,"__esModule",{value:!0}),$.SignalConnections=void 0;let o=class{constructor(){this.list=[]}add(e){this.list.push(e)}disconnectAll(){for(const e of this.list)e.disconnect();this.list=[]}getCount(){return this.list.length}isEmpty(){return this.list.length===0}};return $.SignalConnections=o,$}var _t;function ne(){return _t||(_t=1,(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.SignalConnections=o.Signal=o.CollectorWhile0=o.CollectorUntil0=o.CollectorLast=o.CollectorArray=o.Collector=void 0;var t=B();Object.defineProperty(o,"Collector",{enumerable:!0,get:function(){return t.Collector}});var e=Zt();Object.defineProperty(o,"CollectorArray",{enumerable:!0,get:function(){return e.CollectorArray}});var s=Bt();Object.defineProperty(o,"CollectorLast",{enumerable:!0,get:function(){return s.CollectorLast}});var i=Gt();Object.defineProperty(o,"CollectorUntil0",{enumerable:!0,get:function(){return i.CollectorUntil0}});var n=Jt();Object.defineProperty(o,"CollectorWhile0",{enumerable:!0,get:function(){return n.CollectorWhile0}});var r=ie();Object.defineProperty(o,"Signal",{enumerable:!0,get:function(){return r.Signal}});var h=se();Object.defineProperty(o,"SignalConnections",{enumerable:!0,get:function(){return h.SignalConnections}})})(pt)),pt}var yt=ne();function ft(o){return typeof o=="string"?g.from(o):o instanceof zt?new g(o):o}var re=Object.defineProperty,oe=(o,t,e)=>t in o?re(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,et=(o,t,e)=>oe(o,typeof t!="symbol"?t+"":t,e);class he extends H{constructor(t,e,s){super(),et(this,"_triggerEvents",new Set(["onPress"])),et(this,"innerView"),et(this,"_active"),et(this,"onChange"),this.innerView=new H,this.addChild(this.innerView),this.onChange=new yt.Signal,t&&(this.views=t),e&&(this.triggerEvents=e),s!==void 0&&this.views.length>0&&(this.active=s),this.setInteractionEvents()}setInteractionEvents(){this.innerView.eventMode="static",this.innerView.on("pointerdown",()=>this.handleEvents("onDown")),this.innerView.on("pointerup",()=>this.handleEvents("onUp")),this.innerView.on("pointerupoutside",()=>this.handleEvents("onUpOut")),this.innerView.on("pointerout",()=>this.handleEvents("onOut")),this.innerView.on("pointertap",()=>this.handleEvents("onPress")),this.innerView.on("pointerover",()=>this.handleEvents("onHover"))}handleEvents(t){this._triggerEvents.has(t)&&this.switch()}get activeView(){if(this.views&&this.active!==void 0&&this.views[this.active])return this.views[this.active]}set views(t){this.innerView.removeChildren(),t.forEach(e=>this.add(e))}get views(){return this.innerView.children}add(t){const e=ft(t);this.innerView.addChild(e),e.visible=!1,this.views.length===1&&(this.active=0)}remove(t){this.views[t]&&this.innerView.removeChild(this.views[t])}set triggerEvents(t){this._triggerEvents=new Set(Array.isArray(t)?t:[t])}get triggerEvents(){return Array.from(this._triggerEvents)}switch(t){if(t!==void 0&&t===this.active)return;const e=this.active;if(this.forceSwitch(t),e!==this.active){const s=this.views.length>2?this.active??0:this.active===1;this.onChange.emit(s)}}forceSwitch(t){if(!(t!==void 0&&t===this.active)){if(this.activeView&&(this.activeView.visible=!1),t!==void 0&&!this.views[t])throw new Error(`View with id ${t} does not exist.`);this._active=t===void 0?this.nextActive:t,this._active!==void 0&&(this.views[this._active].visible=!0)}}get nextActive(){if(this.views.length!==0)return this.active===void 0?0:this.active<this.views.length-1?this.active+1:0}set active(t){this.switch(t)}get active(){return this._active}}function ae(o){o&&(o.parent&&o.parent.removeChild(o),o.destroy())}var le=Object.defineProperty,pe=(o,t,e)=>t in o?le(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,it=(o,t,e)=>pe(o,typeof t!="symbol"?t+"":t,e);class z extends he{constructor(t){super(),it(this,"labelText"),it(this,"onCheck"),it(this,"_style"),it(this,"_textClass"),this._textClass=t.TextClass??qt,this.text=t.text??"",this.style=t.style,this.checked=t.checked??!1,this.triggerEvents=["onPress"],this.innerView.cursor="pointer",this.onCheck=new yt.Signal,this.onChange.connect(()=>this.onCheck.emit(this.checked))}addLabel(t,e){t&&(this.labelText=new this._textClass({text:t??"",style:e??this._style?.text}),this.addChild(this.labelText),this.labelText.cursor="pointer",this.labelText.eventMode="static",this.labelText.on("pointertap",()=>this.checked=!this.checked),this.alignText())}set text(t){if(!t){this.labelText&&(ae(this.labelText),this.labelText=void 0);return}this.labelText?this.labelText.text=t:this.addLabel(t),this.alignText()}get text(){return this.labelText?.text??""}set style(t){const e=this.checked;this._style=t;const{unchecked:s,checked:i}=t,n=ft(s),r=ft(i);this.views=[n,r],e?(r.visible=!0,n.visible=!1,this.active=1):(n.visible=!0,r.visible=!1,this.active=0),this.labelText&&t.text&&(this.labelText.style=t.text,this.alignText())}get style(){return this._style}alignText(){if(!this.style||!this.labelText||!this.views)return;const t=this.views[0];t&&(this.labelText.x=t.width+10+(this._style?.textOffset?.x??0),this.labelText.y=(t.height-this.labelText.height)/2+(this._style?.textOffset?.y??0))}get checked(){return this.active===1}set checked(t){this.switch(t?1:0)}forceCheck(t){this.forceSwitch(t?1:0)}}var ce=Object.defineProperty,ue=(o,t,e)=>t in o?ce(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,st=(o,t,e)=>ue(o,typeof t!="symbol"?t+"":t,e);class de extends H{constructor(t){super(),st(this,"options"),st(this,"_type","bidirectional"),st(this,"_maxWidth",0),st(this,"children",[]),t&&(t.maxWidth&&(this._maxWidth=t.maxWidth),this.init(t)),t?.items?.forEach(e=>this.addChild(e)),this.on("added",()=>this.arrangeChildren()),this.on("childAdded",()=>this.arrangeChildren())}init(t){this.options=t,t?.type&&(this.type=t.type),t?.children&&t.children.forEach(e=>this.addChild(e))}set type(t){this._type=t,this.arrangeChildren()}get type(){return this._type}set elementsMargin(t){if(!this.options)throw new Error("List has not been initiated!");this.options.elementsMargin=t,this.arrangeChildren()}get elementsMargin(){return this.options?.elementsMargin??0}set padding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.padding=t,this.options.vertPadding=t,this.options.horPadding=t,this.options.leftPadding=t,this.options.rightPadding=t,this.options.topPadding=t,this.options.bottomPadding=t,this.arrangeChildren()}get padding(){return this.options?.padding??0}set vertPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.vertPadding=t,this.options.topPadding=t,this.options.bottomPadding=t,this.arrangeChildren()}get vertPadding(){return this.options?.vertPadding??this.padding??0}set horPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.horPadding=t,this.options.leftPadding=t,this.options.rightPadding=t,this.arrangeChildren()}get horPadding(){return this.options?.horPadding??this.padding??0}set leftPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.leftPadding=t,this.arrangeChildren()}get leftPadding(){return this.options?.leftPadding??this.horPadding}set rightPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.rightPadding=t,this.arrangeChildren()}get rightPadding(){return this.options?.rightPadding??this.horPadding}set topPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.topPadding=t,this.arrangeChildren()}get topPadding(){return this.options?.topPadding??this.vertPadding}set bottomPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.bottomPadding=t,this.arrangeChildren()}get bottomPadding(){return this.options?.bottomPadding??this.vertPadding}arrangeChildren(){let t=0,e=this.leftPadding,s=this.topPadding;const i=this.options?.elementsMargin??0;let n=this.maxWidth||this.parent?.width;this.rightPadding&&(n-=this.rightPadding),this.children.forEach((r,h)=>{switch(this.type){case"vertical":r.y=s,r.x=e,s+=i+r.height;break;case"horizontal":r.x=e,r.y=s,e+=i+r.width;break;case"bidirectional":default:r.x=e,r.y=s,r.x+r.width>n&&h>0&&(s+=i+t,e=this.leftPadding,r.x=e,r.y=s,t=0),t=Math.max(t,r.height),e+=i+r.width;break}})}removeItem(t){const e=this.children[t];e&&(this.removeChild(e),this.arrangeChildren())}set maxWidth(t){this._maxWidth=t,this.arrangeChildren()}get maxWidth(){return this._maxWidth}}var fe=Object.defineProperty,ge=(o,t,e)=>t in o?fe(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,E=(o,t,e)=>ge(o,typeof t!="symbol"?t+"":t,e);class Xt extends H{constructor(t){super(),E(this,"items",[]),E(this,"innerView"),E(this,"value",""),E(this,"selected",0),E(this,"onChange"),E(this,"options");const e={items:[],type:"vertical",elementsMargin:0,selectedItem:0};this.options={...e,...t},this.onChange=new yt.Signal,this.init(this.options)}init(t){this.options=t,this.selected=t.selectedItem??0,this.value=t.items[this.selected]?.labelText?.text??"",this.innerView?(this.innerView.type=t.type,this.innerView.elementsMargin=t.elementsMargin):this.innerView=new de({type:t.type,elementsMargin:t.elementsMargin}),this.addItems(t.items),this.addChild(this.innerView),this.selectItem(this.selected)}addItems(t){t.forEach((e,s)=>{e.onChange.connect(()=>this.selectItem(s)),this.items.push(e),this.innerView?.addChild(e)})}removeItems(t){t.forEach(e=>{const s=this.items[e];s&&(s.onChange.disconnectAll(),this.innerView?.removeChild(s),this.items.splice(e,1))})}selectItem(t){this.items.forEach((e,s)=>{e.forceCheck(s===t)}),this.selected!==t&&this.onChange.emit(t,this.items[t].labelText?.text??""),this.value=this.options.items[t].labelText?.text??"",this.selected=t}}const ot=await T.load("assets/cursor.png"),gt=await T.load("assets/tree.png"),we=await T.load("assets/heavy.png"),wt=await T.load("assets/water.png"),It=await T.load("assets/elevation.png"),Lt=await T.load("assets/plus.png"),Tt=await T.load("assets/minus.png"),k=.1,q=k*1.1,V=15,at=ot.width*k+V+5,Vt=ot.width*k+V+20,G=new H,me=new ht().roundRect(0,0,at*4,Vt,10).fill({color:5592405,alpha:.8});G.addChild(me);G.x=w.screen.width/2-at*2;G.y=15;const x=new Xt({items:[new z({style:{unchecked:new g({scale:k,texture:ot}),checked:new g({scale:q,texture:ot})}}),new z({style:{unchecked:new g({scale:k,texture:gt}),checked:new g({scale:q,texture:gt})}}),new z({style:{unchecked:new g({scale:k,texture:wt}),checked:new g({scale:q,texture:wt})}}),new z({style:{unchecked:new g({scale:k,texture:It,tint:16777215}),checked:new g({scale:q,texture:It,tint:5592405})}})],type:"horizontal",elementsMargin:V});x.innerView&&(x.innerView.padding=V);x.interactive=!0;G.addChild(x);const J=new H,ve=new ht().roundRect(0,0,at*2+10,Vt,10).fill({color:5592405,alpha:.8});J.addChild(ve);J.x=w.screen.width/2-at;J.y=w.screen.height-100;const X=new Xt({items:[new z({style:{unchecked:new g({scale:k,texture:Lt}),checked:new g({scale:q,texture:Lt})}}),new z({style:{unchecked:new g({scale:k,texture:Tt}),checked:new g({scale:q,texture:Tt})}})],type:"horizontal",elementsMargin:V});X.innerView&&(X.innerView.padding=V);X.interactive=!0;J.addChild(X);var ye=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xe(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Dt={exports:{}};(function(o,t){(function(){var e,s;s=function(i){return o.exports=i},e={linear:function(i,n,r,h){return r*i/h+n},easeInQuad:function(i,n,r,h){return r*(i/=h)*i+n},easeOutQuad:function(i,n,r,h){return-r*(i/=h)*(i-2)+n},easeInOutQuad:function(i,n,r,h){return(i/=h/2)<1?r/2*i*i+n:-r/2*(--i*(i-2)-1)+n},easeInCubic:function(i,n,r,h){return r*(i/=h)*i*i+n},easeOutCubic:function(i,n,r,h){return r*((i=i/h-1)*i*i+1)+n},easeInOutCubic:function(i,n,r,h){return(i/=h/2)<1?r/2*i*i*i+n:r/2*((i-=2)*i*i+2)+n},easeInQuart:function(i,n,r,h){return r*(i/=h)*i*i*i+n},easeOutQuart:function(i,n,r,h){return-r*((i=i/h-1)*i*i*i-1)+n},easeInOutQuart:function(i,n,r,h){return(i/=h/2)<1?r/2*i*i*i*i+n:-r/2*((i-=2)*i*i*i-2)+n},easeInQuint:function(i,n,r,h){return r*(i/=h)*i*i*i*i+n},easeOutQuint:function(i,n,r,h){return r*((i=i/h-1)*i*i*i*i+1)+n},easeInOutQuint:function(i,n,r,h){return(i/=h/2)<1?r/2*i*i*i*i*i+n:r/2*((i-=2)*i*i*i*i+2)+n},easeInSine:function(i,n,r,h){return-r*Math.cos(i/h*(Math.PI/2))+r+n},easeOutSine:function(i,n,r,h){return r*Math.sin(i/h*(Math.PI/2))+n},easeInOutSine:function(i,n,r,h){return-r/2*(Math.cos(Math.PI*i/h)-1)+n},easeInExpo:function(i,n,r,h){return i===0?n:r*Math.pow(2,10*(i/h-1))+n},easeOutExpo:function(i,n,r,h){return i===h?n+r:r*(-Math.pow(2,-10*i/h)+1)+n},easeInOutExpo:function(i,n,r,h){return(i/=h/2)<1?r/2*Math.pow(2,10*(i-1))+n:r/2*(-Math.pow(2,-10*--i)+2)+n},easeInCirc:function(i,n,r,h){return-r*(Math.sqrt(1-(i/=h)*i)-1)+n},easeOutCirc:function(i,n,r,h){return r*Math.sqrt(1-(i=i/h-1)*i)+n},easeInOutCirc:function(i,n,r,h){return(i/=h/2)<1?-r/2*(Math.sqrt(1-i*i)-1)+n:r/2*(Math.sqrt(1-(i-=2)*i)+1)+n},easeInElastic:function(i,n,r,h){var a,l,p;return p=1.70158,l=0,a=r,i===0||(i/=h),l||(l=h*.3),a<Math.abs(r)?(a=r,p=l/4):p=l/(2*Math.PI)*Math.asin(r/a),-(a*Math.pow(2,10*(i-=1))*Math.sin((i*h-p)*(2*Math.PI)/l))+n},easeOutElastic:function(i,n,r,h){var a,l,p;return p=1.70158,l=0,a=r,i===0||(i/=h),l||(l=h*.3),a<Math.abs(r)?(a=r,p=l/4):p=l/(2*Math.PI)*Math.asin(r/a),a*Math.pow(2,-10*i)*Math.sin((i*h-p)*(2*Math.PI)/l)+r+n},easeInOutElastic:function(i,n,r,h){var a,l,p;return p=1.70158,l=0,a=r,i===0||(i/=h/2),l||(l=h*(.3*1.5)),a<Math.abs(r)?(a=r,p=l/4):p=l/(2*Math.PI)*Math.asin(r/a),i<1?-.5*(a*Math.pow(2,10*(i-=1))*Math.sin((i*h-p)*(2*Math.PI)/l))+n:a*Math.pow(2,-10*(i-=1))*Math.sin((i*h-p)*(2*Math.PI)/l)*.5+r+n},easeInBack:function(i,n,r,h,a){return a===void 0&&(a=1.70158),r*(i/=h)*i*((a+1)*i-a)+n},easeOutBack:function(i,n,r,h,a){return a===void 0&&(a=1.70158),r*((i=i/h-1)*i*((a+1)*i+a)+1)+n},easeInOutBack:function(i,n,r,h,a){return a===void 0&&(a=1.70158),(i/=h/2)<1?r/2*(i*i*(((a*=1.525)+1)*i-a))+n:r/2*((i-=2)*i*(((a*=1.525)+1)*i+a)+2)+n},easeInBounce:function(i,n,r,h){var a;return a=e.easeOutBounce(h-i,0,r,h),r-a+n},easeOutBounce:function(i,n,r,h){return(i/=h)<1/2.75?r*(7.5625*i*i)+n:i<2/2.75?r*(7.5625*(i-=1.5/2.75)*i+.75)+n:i<2.5/2.75?r*(7.5625*(i-=2.25/2.75)*i+.9375)+n:r*(7.5625*(i-=2.625/2.75)*i+.984375)+n},easeInOutBounce:function(i,n,r,h){var a;return i<h/2?(a=e.easeInBounce(i*2,0,r,h),a*.5+n):(a=e.easeOutBounce(i*2-h,0,r,h),a*.5+r*.5+n)}},s(e)}).call(ye)})(Dt);var be=Dt.exports;const Et=xe(be);function lt(o,t){if(o){if(typeof o=="function")return o;if(typeof o=="string")return Et[o]}else return Et[t]}class Ce{constructor(t){this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.eventMode="static",this.viewport.forceHitArea||(this.viewport.hitArea=new rt(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.options.allowPreserveDragOutside?this.viewport.on("globalpointermove",this.move,this):this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.options.allowPreserveDragOutside||this.viewport.on("pointerleave",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.events.domElement.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){var t;(t=this.viewport.options.events.domElement)==null||t.removeEventListener("wheel",this.wheelFunction)}down(t){if(!(this.viewport.pause||!this.viewport.visible)){if(t.pointerType==="mouse"?this.isMouseDown=!0:this.get(t.pointerId)||this.touches.push({id:t.pointerId,last:null}),this.count()===1){this.last=t.global.clone();const e=this.viewport.plugins.get("decelerate",!0),s=this.viewport.plugins.get("bounce",!0);(!e||!e.isActive())&&(!s||!s.isActive())?this.clickedAvailable=!0:this.clickedAvailable=!1}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.visible)return;const e=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const s=t.global.x-this.last.x,i=t.global.y-this.last.y;(this.checkThreshold(s)||this.checkThreshold(i))&&(this.clickedAvailable=!1)}e&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.visible)return;t.pointerType==="mouse"&&(this.isMouseDown=!1),t.pointerType!=="mouse"&&this.remove(t.pointerId);const e=this.viewport.plugins.up(t);this.clickedAvailable&&this.count()===0&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this.viewport}),this.clickedAvailable=!1),e&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const e=new d;return this.viewport.options.events.mapPositionToPoint(e,t.clientX,t.clientY),e}handleWheel(t){if(this.viewport.pause||!this.viewport.visible)return;const e=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=e.x&&e.x<=this.viewport.right&&this.viewport.top<=e.y&&e.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const e of this.touches)if(e.id===t)return e;return null}remove(t){for(let e=0;e<this.touches.length;e++)if(this.touches[e].id===t){this.touches.splice(e,1);return}}count(){return(this.isMouseDown?1:0)+this.touches.length}}const Q=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class We{constructor(t){this.viewport=t,this.list=[],this.plugins={}}add(t,e,s=Q.length){const i=this.plugins[t];i&&i.destroy(),this.plugins[t]=e;const n=Q.indexOf(t);n!==-1&&Q.splice(n,1),Q.splice(s,0,t),this.sort()}get(t,e){var s;return e&&(s=this.plugins[t])!=null&&s.paused?null:this.plugins[t]}update(t){for(const e of this.list)e.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.list.forEach(t=>{t.destroy()}),this.plugins={},this.sort()}remove(t){var e;this.plugins[t]&&((e=this.plugins[t])==null||e.destroy(),delete this.plugins[t],this.viewport.emit("plugin-remove",t),this.sort())}pause(t){var e;(e=this.plugins[t])==null||e.pause()}resume(t){var e;(e=this.plugins[t])==null||e.resume()}sort(){this.list=[];for(const t of Q)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let e=!1;for(const s of this.list)s.down(t)&&(e=!0);return e}move(t){let e=!1;for(const s of this.viewport.plugins.list)s.move(t)&&(e=!0);return e}up(t){let e=!1;for(const s of this.list)s.up(t)&&(e=!0);return e}wheel(t){let e=!1;for(const s of this.list)s.wheel(t)&&(e=!0);return e}}class b{constructor(t){this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}const Pe={removeOnInterrupt:!1,ease:"linear",time:1e3};class Me extends b{constructor(t,e={}){super(t),this.startWidth=null,this.startHeight=null,this.deltaWidth=null,this.deltaHeight=null,this.width=null,this.height=null,this.time=0,this.options=Object.assign({},Pe,e),this.options.ease=lt(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),this.width!==null&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),this.height!==null&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),this.width!==null&&this.parent.fitWidth(this.width,this.keepCenter,this.height===null),this.height!==null&&this.parent.fitHeight(this.height,this.keepCenter,this.width===null),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(this.paused)return;this.time+=t;const e=new d(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const s=this.parent.width,i=this.parent.height;this.complete(),(s!==this.parent.width||i!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}else{const s=this.options.ease(this.time,0,1,this.options.time);if(this.width!==null){const i=this.startWidth,n=this.deltaWidth;this.parent.fitWidth(i+n*s,this.keepCenter,this.height===null)}if(this.height!==null){const i=this.startHeight,n=this.deltaHeight;this.parent.fitHeight(i+n*s,this.keepCenter,this.width===null)}if(this.width===null?this.parent.scale.x=this.parent.scale.y:this.height===null&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const i=this.startX,n=this.startY,r=this.deltaX,h=this.deltaY,a=new d(this.parent.x,this.parent.y);this.parent.moveCenter(i+r*s,n+h*s),this.parent.emit("moved",{viewport:this.parent,original:a,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}}}const Se={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class ke extends b{constructor(t,e={}){super(t),this.options=Object.assign({},Se,e),this.ease=lt(this.options.ease,"easeInOutSine"),this.options.sides?this.options.sides==="all"?this.top=this.bottom=this.left=this.right=!0:this.options.sides==="horizontal"?(this.right=this.left=!0,this.top=this.bottom=!1):this.options.sides==="vertical"?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=this.options.sides.indexOf("top")!==-1,this.bottom=this.options.sides.indexOf("bottom")!==-1,this.left=this.options.sides.indexOf("left")!==-1,this.right=this.options.sides.indexOf("right")!==-1):this.left=this.top=this.right=this.bottom=!1;const s=this.options.underflow.toLowerCase();s==="center"?(this.underflowX=0,this.underflowY=0):(this.underflowX=s.indexOf("left")!==-1?-1:s.indexOf("right")!==-1?1:0,this.underflowY=s.indexOf("top")!==-1?-1:s.indexOf("bottom")!==-1?1:0),this.reset()}isActive(){return this.toX!==null||this.toY!==null}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const e=this.toX;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),e.time>=this.options.time?(this.parent.x=e.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(e.time,e.start,e.delta,this.options.time)}if(this.toY){const e=this.toY;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),e.time>=this.options.time?(this.parent.y=e.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(e.time,e.start,e.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const e=typeof t.x>"u"?0:t.x,s=typeof t.y>"u"?0:t.y,i=typeof t.width>"u"?this.parent.worldWidth:t.width,n=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<e,right:this.parent.right>i,top:this.parent.top<s,bottom:this.parent.bottom>n,topLeft:new d(e*this.parent.scale.x,s*this.parent.scale.y),bottomRight:new d(i*this.parent.scale.x-this.parent.screenWidth,n*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new d(0,0),bottomRight:new d(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){var t,e;if(this.paused)return;let s,i=this.parent.plugins.get("decelerate",!0);i&&(i.x||i.y)&&(i.x&&i.percentChangeX===((t=i.options)==null?void 0:t.friction)||i.y&&i.percentChangeY===((e=i.options)==null?void 0:e.friction))&&(s=this.oob(),(s.left&&this.left||s.right&&this.right)&&(i.percentChangeX=this.options.friction),(s.top&&this.top||s.bottom&&this.bottom)&&(i.percentChangeY=this.options.friction));const n=this.parent.plugins.get("drag",!0)||{},r=this.parent.plugins.get("pinch",!0)||{};if(i=i||{},!(n!=null&&n.active)&&!(r!=null&&r.active)&&(!this.toX||!this.toY)&&(!i.x||!i.y)){s=s||this.oob();const h=s.topLeft,a=s.bottomRight;if(!this.toX&&!i.x){let l=null;s.left&&this.left?l=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-h.x:s.right&&this.right&&(l=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-a.x),l!==null&&this.parent.x!==l&&(this.toX={time:0,start:this.parent.x,delta:l-this.parent.x,end:l},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!i.y){let l=null;s.top&&this.top?l=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-h.y:s.bottom&&this.bottom&&(l=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-a.y),l!==null&&this.parent.y!==l&&(this.toY={time:0,start:this.parent.y,delta:l-this.parent.y,end:l},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const He={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class Oe extends b{constructor(t,e={}){super(t),this.options=Object.assign({},He,e),this.options.direction&&(this.options.left=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.right=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.top=this.options.direction==="y"||this.options.direction==="all"?!0:null,this.options.bottom=this.options.direction==="y"||this.options.direction==="all"?!0:null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="none"?this.noUnderflow=!0:t==="center"?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=t.indexOf("left")!==-1?-1:t.indexOf("right")!==-1?1:0,this.underflowY=t.indexOf("top")!==-1?-1:t.indexOf("bottom")!==-1?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t=new d(this.parent.x,this.parent.y),e=this.parent.plugins.decelerate||{};if(this.options.left!==null||this.options.right!==null){let s=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x!==0&&(this.parent.x=0,s=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,s=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,s=!0)}else this.options.left!==null&&this.parent.left<(this.options.left===!0?0:this.options.left)&&(this.parent.x=-(this.options.left===!0?0:this.options.left)*this.parent.scale.x,e.x=0,s=!0),this.options.right!==null&&this.parent.right>(this.options.right===!0?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(this.options.right===!0?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,e.x=0,s=!0);s&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(this.options.top!==null||this.options.bottom!==null){let s=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y!==0&&(this.parent.y=0,s=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,s=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,s=!0)}else this.options.top!==null&&this.parent.top<(this.options.top===!0?0:this.options.top)&&(this.parent.y=-(this.options.top===!0?0:this.options.top)*this.parent.scale.y,e.y=0,s=!0),this.options.bottom!==null&&this.parent.bottom>(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,e.y=0,s=!0);s&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const _e={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class Ie extends b{constructor(t,e={}){super(t),this.options=Object.assign({},_e,e),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused){if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight;if(this.options.minWidth!==null&&t<this.options.minWidth){const s=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/s,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxWidth!==null&&t>this.options.maxWidth){const s=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/s,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.minHeight!==null&&e<this.options.minHeight){const s=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/s,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxHeight!==null&&e>this.options.maxHeight){const s=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/s,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},e={x:null,y:null};if(typeof this.options.minScale=="number")t.x=this.options.minScale,t.y=this.options.minScale;else if(this.options.minScale!==null){const n=this.options.minScale;t.x=typeof n.x>"u"?null:n.x,t.y=typeof n.y>"u"?null:n.y}if(typeof this.options.maxScale=="number")e.x=this.options.maxScale,e.y=this.options.maxScale;else if(this.options.maxScale!==null){const n=this.options.maxScale;e.x=typeof n.x>"u"?null:n.x,e.y=typeof n.y>"u"?null:n.y}let s=this.parent.scale.x,i=this.parent.scale.y;t.x!==null&&s<t.x&&(s=t.x),e.x!==null&&s>e.x&&(s=e.x),t.y!==null&&i<t.y&&(i=t.y),e.y!==null&&i>e.y&&(i=e.y),(s!==this.parent.scale.x||i!==this.parent.scale.y)&&(this.parent.scale.set(s,i),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}}reset(){this.clamp()}}const Le={friction:.98,bounce:.8,minSpeed:.01},O=16;class Te extends b{constructor(t,e={}){super(t),this.options=Object.assign({},Le,e),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",s=>this.handleMoved(s))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!!(this.x||this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(t===1||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}handleMoved(t){if(this.saved.length){const e=this.saved[this.saved.length-1];t.type==="clamp-x"&&t.original?e.x===t.original.x&&(e.x=this.parent.x):t.type==="clamp-y"&&t.original&&e.y===t.original.y&&(e.y=this.parent.y)}}up(){if(this.parent.input.count()===0&&this.saved.length){const t=performance.now();for(const e of this.saved)if(e.time>=t-100){const s=t-e.time;this.x=(this.parent.x-e.x)/s,this.y=(this.parent.y-e.y)/s,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){t=t||{},typeof t.x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const e=this.x||this.y,s=this.timeSinceRelease,i=this.timeSinceRelease+t;if(this.x){const n=this.percentChangeX,r=Math.log(n);this.parent.x+=this.x*O/r*(Math.pow(n,i/O)-Math.pow(n,s/O)),this.x*=Math.pow(this.percentChangeX,t/O)}if(this.y){const n=this.percentChangeY,r=Math.log(n);this.parent.y+=this.y*O/r*(Math.pow(n,i/O)-Math.pow(n,s/O)),this.y*=Math.pow(this.percentChangeY,t/O)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),e&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const Ee={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};class ze extends b{constructor(t,e={}){super(t),this.windowEventHandlers=[],this.options=Object.assign({},Ee,e),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="x",this.yDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="y",this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){const e=i=>{t.includes(i.code)&&(this.keyIsPressed=!0)},s=i=>{t.includes(i.code)&&(this.keyIsPressed=!1)};this.addWindowEventHandler("keyup",s),this.addWindowEventHandler("keydown",e)}addWindowEventHandler(t,e){typeof window>"u"||(window.addEventListener(t,e),this.windowEventHandlers.push({event:t,handler:e}))}destroy(){typeof window>"u"||this.windowEventHandlers.forEach(({event:t,handler:e})=>{window.removeEventListener(t,e)})}mouseButtons(t){!t||t==="all"?this.mouse=[!0,!0,!0]:this.mouse=[t.indexOf("left")!==-1,t.indexOf("middle")!==-1,t.indexOf("right")!==-1]}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="center"?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const e=t.pointerType==="mouse",s=this.parent.input.count();return!!((s===1||s>1&&!this.parent.plugins.get("pinch",!0))&&(!e||this.mouse[t.button]))}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&t.data.pointerType==="touch"}down(t){return this.paused||!this.options.pressDrag?!1:this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.global.x,y:t.global.y},(this.parent.parent||this.parent).toLocal(this.last,void 0,this.last),this.current=t.pointerId,!0):(this.last=null,!1)}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const e=t.global.x,s=t.global.y,i=this.parent.input.count();if(i===1||i>1&&!this.parent.plugins.get("pinch",!0)){const n={x:e,y:s};(this.parent.parent||this.parent).toLocal(n,void 0,n);const r=n.x-this.last.x,h=n.y-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(r)||this.yDirection&&this.parent.input.checkThreshold(h))return this.xDirection&&(this.parent.x+=(n.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(n.y-this.last.y)*this.options.factor),this.last=n,this.moved||this.parent.emit("drag-start",{event:t,screen:new d(this.last.x,this.last.y),world:this.parent.toWorld(new d(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const e=this.parent.input.touches;if(e.length===1){const s=e[0];return s.last&&(this.last={x:s.last.x,y:s.last.y},this.current=s.id),this.moved=!1,!0}else if(this.last&&this.moved){const s=new d(this.last.x,this.last.y);return(this.parent.parent||this.parent).toGlobal(s,s,!0),this.parent.emit("drag-end",{event:t,screen:s,world:this.parent.toWorld(s),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const e=this.parent.plugins.get("wheel",!0);if(!e||!e.options.wheelZoom&&!t.ctrlKey){const s=t.deltaMode?this.options.lineHeight:1,i=[t.deltaX,t.deltaY],[n,r]=this.options.wheelSwapAxes?i.reverse():i;return this.xDirection&&(this.parent.x+=n*s*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=r*s*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if(this.options.clampWheel!=="y")if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if(this.options.clampWheel!=="x")if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const qe={speed:0,acceleration:null,radius:null};class Ye extends b{constructor(t,e,s={}){super(t),this.target=e,this.options=Object.assign({},qe,s),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const e=this.parent.center;let s=this.target.x,i=this.target.y;if(this.options.radius)if(Math.sqrt(Math.pow(this.target.y-e.y,2)+Math.pow(this.target.x-e.x,2))>this.options.radius){const h=Math.atan2(this.target.y-e.y,this.target.x-e.x);s=this.target.x-Math.cos(h)*this.options.radius,i=this.target.y-Math.sin(h)*this.options.radius}else return;const n=s-e.x,r=i-e.y;if(n||r)if(this.options.speed)if(this.options.acceleration){const h=Math.atan2(i-e.y,s-e.x),a=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));if(a){const l=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);a>l?this.velocity={x:Math.min(this.velocity.x+(this.options.acceleration*t,this.options.speed)),y:Math.min(this.velocity.y+(this.options.acceleration*t,this.options.speed))}:this.velocity={x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const p=Math.cos(h)*this.velocity.x,m=Math.sin(h)*this.velocity.y,C=Math.abs(p)>Math.abs(n)?s:e.x+p,P=Math.abs(m)>Math.abs(r)?i:e.y+m;this.parent.moveCenter(C,P),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const h=Math.atan2(i-e.y,s-e.x),a=Math.cos(h)*this.options.speed,l=Math.sin(h)*this.options.speed,p=Math.abs(a)>Math.abs(n)?s:e.x+a,m=Math.abs(l)>Math.abs(r)?i:e.y+l;this.parent.moveCenter(p,m),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(s,i),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const Xe={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class Ve extends b{constructor(t,e={}){super(t),this.options=Object.assign({},Xe,e),this.reverse=this.options.reverse?1:-1,this.radiusSquared=typeof this.options.radius=="number"?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;t!==null?(this.left=t,this.top=t,this.right=this.parent.screenWidth-t,this.bottom=this.parent.screenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=this.options.right===null?null:this.parent.screenWidth-this.options.right,this.bottom=this.options.bottom===null?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||t.pointerType!=="mouse"&&t.pointerId!==1||!this.options.allowButtons&&t.buttons!==0)return!1;const e=t.global.x,s=t.global.y;if(this.radiusSquared){const i=this.parent.toScreen(this.parent.center);if(Math.pow(i.x-e,2)+Math.pow(i.y-s,2)>=this.radiusSquared){const n=Math.atan2(i.y-s,i.x-e);this.options.linear?(this.horizontal=Math.round(Math.cos(n))*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.round(Math.sin(n))*this.options.speed*this.reverse*(60/1e3)):(this.horizontal=Math.cos(n)*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.sin(n)*this.options.speed*this.reverse*(60/1e3))}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else this.left!==null&&e<this.left?this.horizontal=Number(this.reverse)*this.options.speed*(60/1e3):this.right!==null&&e>this.right?this.horizontal=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateHorizontal(),this.horizontal=0),this.top!==null&&s<this.top?this.vertical=Number(this.reverse)*this.options.speed*(60/1e3):this.bottom!==null&&s>this.bottom?this.vertical=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const De={noDrag:!1,percent:1,center:null,factor:1,axis:"all"},Ae=new d;class Re extends b{constructor(t,e={}){super(t),this.active=!1,this.pinching=!1,this.moved=!1,this.options=Object.assign({},De,e)}down(){return this.parent.input.count()>=2?(this.active=!0,!0):!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const{x:e,y:s}=(this.parent.parent||this.parent).toLocal(t.global,void 0,Ae),i=this.parent.input.touches;if(i.length>=2){const n=i[0],r=i[1],h=n.last&&r.last?Math.sqrt(Math.pow(r.last.x-n.last.x,2)+Math.pow(r.last.y-n.last.y,2)):null;if(n.id===t.pointerId?n.last={x:e,y:s,data:t}:r.id===t.pointerId&&(r.last={x:e,y:s,data:t}),h){let a;const l=new d(n.last.x+(r.last.x-n.last.x)/2,n.last.y+(r.last.y-n.last.y)/2);this.options.center||(a=this.parent.toLocal(l,this.parent.parent||this.parent));let p=Math.sqrt(Math.pow(r.last.x-n.last.x,2)+Math.pow(r.last.y-n.last.y,2));p=p===0?p=1e-10:p;const m=(1-h/p)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=m),this.isAxisY()&&(this.parent.scale.y+=m),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:l});const C=this.parent.plugins.get("clamp-zoom",!0);if(C&&C.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const P=(this.parent.parent||this.parent).toLocal(a,this.parent);this.parent.x+=(l.x-P.x)*this.options.factor,this.parent.y+=(l.y-P.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(l.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(l.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=l,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return this.pinching&&this.parent.input.touches.length<=1?(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0):!1}}const Ne={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class je extends b{constructor(t,e,s,i={}){super(t),this.options=Object.assign({},Ne,i),this.ease=lt(i.ease,"easeInOutSine"),this.x=e,this.y=s,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(this.parent.input.count()===0){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!this.paused&&!(this.options.interrupt&&this.parent.input.count()!==0))if(this.snapping){const e=this.snapping;e.time+=t;let s,i,n;const r=this.startX,h=this.startY,a=this.deltaX,l=this.deltaY;if(e.time>this.options.time)s=!0,i=r+a,n=h+l;else{const p=this.ease(e.time,0,1,this.options.time);i=r+a*p,n=h+l*p}this.options.topLeft?this.parent.moveCorner(i,n):this.parent.moveCenter(i,n),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),s&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const e=this.options.topLeft?this.parent.corner:this.parent.center;(e.x!==this.x||e.y!==this.y)&&this.snapStart()}}}const Fe={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class Ue extends b{constructor(t,e={}){super(t),this.options=Object.assign({},Fe,e),this.ease=lt(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,this.options.time===0?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):e.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,s=this.parent.screenWidth/this.xScale,i=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:e,deltaX:s-t,deltaY:i-e},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&this.parent.input.count()!==0)return;let e;if(!this.options.center&&!this.options.noMove&&(e=this.parent.center),!this.snapping)(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping();else if(this.snapping){const s=this.snapping;if(s.time+=t,s.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const n=this.snapping,r=this.ease(n.time,n.startX,n.deltaX,this.options.time),h=this.ease(n.time,n.startY,n.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/r,this.parent.scale.y=this.parent.screenHeight/h}const i=this.parent.plugins.get("clamp-zoom",!0);i&&i.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(e))}}resume(){this.snapping=null,super.resume()}}const Ke={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class $e extends b{constructor(t,e={}){super(t),this.options=Object.assign({},Ke,e),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){typeof window>"u"||(window.addEventListener("keydown",e=>{t.includes(e.code)&&(this.keyIsPressed=!0)}),window.addEventListener("keyup",e=>{t.includes(e.code)&&(this.keyIsPressed=!1)}))}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,e=this.smoothing;let s;this.options.center||(s=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=e.x),this.isAxisY()&&(this.parent.scale.y+=e.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const i=this.parent.plugins.get("clamp-zoom",!0);if(i&&i.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const n=this.parent.parent||this.parent;n.toLocal(s,this.parent,s);const r=n.toLocal(t);this.parent.x+=r.x-s.x,this.parent.y+=r.y-s.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,typeof this.options.smooth=="number"&&this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const e=this.parent.input.getPointerPosition(t),s=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,i=Math.pow(2,(1+this.options.percent)*s);let n;this.options.center||(n=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=i),this.isAxisY()&&(this.parent.scale.y*=i),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const r=this.parent.plugins.get("clamp-zoom",!0);if(r&&r.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const h=this.parent.parent||this.parent;h.toLocal(n,this.parent,n);const a=h.toLocal(e);this.parent.x+=a.x-n.x,this.parent.y+=a.y-n.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const e=this.parent.input.getPointerPosition(t),s=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,i=Math.pow(2,(1+this.options.percent)*s);if(this.options.smooth){const n={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+n.x)*i-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+n.y)*i-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=e}else{let n;this.options.center||(n=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=i),this.isAxisY()&&(this.parent.scale.y*=i),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const r=this.parent.plugins.get("clamp-zoom",!0);if(r&&r.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const h=this.parent.parent||this.parent;h.toLocal(n,this.parent,n);const a=h.toLocal(e);this.parent.x+=a.x-n.x,this.parent.y+=a.y-n.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}const Qe={screenWidth:typeof window>"u"?0:window.innerWidth,screenHeight:typeof window>"u"?0:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,disableOnContextMenu:!1,ticker:$t.shared,allowPreserveDragOutside:!1};class Ze extends H{constructor(t){super(),this._disableOnContextMenu=e=>e.preventDefault(),this.options={...Qe,...t},this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.disableOnContextMenu&&this.options.events.domElement.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new Ce(this),this.plugins=new We(this)}destroy(t){var e;!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&((e=this.options.events.domElement)==null||e.removeEventListener("contextmenu",this._disableOnContextMenu)),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new rt(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=typeof window>"u"?0:window.innerWidth,e=typeof window>"u"?0:window.innerHeight,s,i){this.screenWidth=t,this.screenHeight=e,typeof s<"u"&&(this._worldWidth=s),typeof i<"u"&&(this._worldHeight=i),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new rt(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,e){return arguments.length===2?this.toLocal(new d(t,e)):this.toLocal(t)}toScreen(t,e){return arguments.length===2?this.toGlobal(new d(t,e)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new d(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let e,s;typeof t[0]=="number"?(e=t[0],s=t[1]):(e=t[0].x,s=t[0].y);const i=(this.worldScreenWidth/2-e)*this.scale.x,n=(this.worldScreenHeight/2-s)*this.scale.y;return(this.x!==i||this.y!==n)&&(this.position.set(i,n),this.plugins.reset(),this.dirty=!0),this}get corner(){return new d(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let e,s;return t.length===1?(e=-t[0].x*this.scale.x,s=-t[0].y*this.scale.y):(e=-t[0]*this.scale.x,s=-t[1]*this.scale.y),(e!==this.x||s!==this.y)&&(this.position.set(e,s),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,e){const s=this.screenWidth/t,i=this.screenHeight/e;return Math.min(s,i)}findCover(t,e){const s=this.screenWidth/t,i=this.screenHeight/e;return Math.max(s,i)}fitWidth(t=this.worldWidth,e,s=!0,i){let n;e&&(n=this.center),this.scale.x=this.screenWidth/t,s&&(this.scale.y=this.scale.x);const r=this.plugins.get("clamp-zoom",!0);return!i&&r&&r.clamp(),e&&n&&this.moveCenter(n),this}fitHeight(t=this.worldHeight,e,s=!0,i){let n;e&&(n=this.center),this.scale.y=this.screenHeight/t,s&&(this.scale.x=this.scale.y);const r=this.plugins.get("clamp-zoom",!0);return!i&&r&&r.clamp(),e&&n&&this.moveCenter(n),this}fitWorld(t){let e;t&&(e=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const s=this.plugins.get("clamp-zoom",!0);return s&&s.clamp(),t&&e&&this.moveCenter(e),this}fit(t,e=this.worldWidth,s=this.worldHeight){let i;t&&(i=this.center),this.scale.x=this.screenWidth/e,this.scale.y=this.screenHeight/s,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const n=this.plugins.get("clamp-zoom",!0);return n&&n.clamp(),t&&i&&this.moveCenter(i),this}setZoom(t,e){let s;e&&(s=this.center),this.scale.set(t);const i=this.plugins.get("clamp-zoom",!0);return i&&i.clamp(),e&&s&&this.moveCenter(s),this}zoomPercent(t,e){return this.setZoom(this.scale.x+this.scale.x*t,e)}zoom(t,e){return this.fitWidth(t+this.worldScreenWidth,e),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new Ue(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new d(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new rt(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new ze(this,t)),this}clamp(t){return this.plugins.add("clamp",new Oe(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new Te(this,t)),this}bounce(t){return this.plugins.add("bounce",new ke(this,t)),this}pinch(t){return this.plugins.add("pinch",new Re(this,t)),this}snap(t,e,s){return this.plugins.add("snap",new je(this,t,e,s)),this}follow(t,e){return this.plugins.add("follow",new Ye(this,t,e)),this}wheel(t){return this.plugins.add("wheel",new $e(this,t)),this}animate(t){return this.plugins.add("animate",new Me(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new Ie(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new Ve(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,e,s,i,n){n&&(s>this.worldScreenWidth||i>this.worldScreenHeight)&&(this.fit(!0,s,i),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let r=!1;t<this.left?(this.left=t,r=!0):t+s>this.right&&(this.right=t+s,r=!0),e<this.top?(this.top=e,r=!0):e+i>this.bottom&&(this.bottom=e+i,r=!0),r&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}class Be{f0;f1;f2;f3;b0;b1;b2;b3;startAngle;constructor(t,e,s,i,n,r,h,a,l){this.f0=t,this.f1=e,this.f2=s,this.f3=i,this.b0=n,this.b1=r,this.b2=h,this.b3=a,this.startAngle=l}}const Ge=new Be(3/2,0,Math.sqrt(3)/2,Math.sqrt(3),2/3,0,-1/3,Math.sqrt(3)/3,0),_={size:{x:50,y:50},orientation:Ge,origin:{x:0,y:0},spacing:1};function Je(o=_.size.x,t=0,e=new d(0,0)){const s=[];for(let i=0;i<6;i++){const n=o*Math.cos(2*Math.PI*i/6+t),r=o*Math.sin(2*Math.PI*i/6+t),h=new d(e.x+n,e.y+r);s.push(h)}return s}class u{q;r;s;constructor(t,e,s){this.q=t,this.r=e,this.s=s}}class f{static DIRECTIONS=[new u(1,0,-1),new u(1,-1,0),new u(0,-1,1),new u(-1,0,1),new u(-1,1,0),new u(0,1,-1)];static equals(t,e){return t.q==e.q&&t.r==e.r&&t.s==e.s}static add(t,e){return new u(t.q+e.q,t.r+e.r,t.s+e.s)}static subtract(t,e){return new u(t.q-e.q,t.r-e.r,t.s-e.s)}static multiply(t,e){return new u(t.q*e,t.r*e,t.s*e)}static lengths(t){return(Math.abs(t.q)+Math.abs(t.r)+Math.abs(t.s))/2}static distance(t,e){return f.lengths(f.subtract(t,e))}static direction(t){return f.DIRECTIONS[(6+t%6)%6]}static neighbor(t,e){return f.add(t,f.direction(e))}static neighbors(t){const e=[];for(let s=0;s<f.DIRECTIONS.length;s+=1)e.push(f.neighbor(t,s));return e}static round(t){let e=Math.round(t.q),s=Math.round(t.r),i=Math.round(t.s);const n=Math.abs(e-t.q),r=Math.abs(s-t.r),h=Math.abs(i-t.s);return n>r&&n>h?e=-s-i:r>h?s=-e-i:i=-e-s,new u(e,s,i)}static hexToPixel(t,e){const s=e.spacing,i=e.orientation;let n=(i.f0*t.q+i.f1*t.r)*e.size.x,r=(i.f2*t.q+i.f3*t.r)*e.size.y;return n=n*s,r=r*s,new d(n+e.origin.x,r+e.origin.y)}static pixelToHex(t,e){const s=e.orientation,i=new d((t.x-e.origin.x)/e.size.x,(t.y-e.origin.y)/e.size.y),n=s.b0*i.x+s.b1*i.y,r=s.b2*i.x+s.b3*i.y,h=new u(n,r,-n-r);return f.round(h)}static lerp(t,e,s){return t+(e-t)*s}static hexLerp(t,e,s){return new u(f.lerp(t.q,e.q,s),f.lerp(t.r,e.r,s),f.lerp(t.s,e.s,s))}static getID(t){return`${t.q},${t.r},${t.s}`}}class ti{hex;container;gfx;color;alpha;sprite;x=0;y=0;attacker=!1;defender=!1;defendersChoice=!1;intervening=!1;blocked=!1;dcBlocked=!1;partialCover=!1;inversePartialCover=!1;woods=0;water=!1;elevation=0;elevationText;constructor(t,e,s,i=16777215,n=1){this.hex=new u(t,e,s),this.container=new H,this.elevationText=new qt,this.elevationText.scale=.55,this.elevationText.x=-25,this.elevationText.y=25,this.gfx=new ht,{x:this.x,y:this.y}=f.hexToPixel(this.hex,_),this.container.position.set(this.x,this.y),this.sprite=new g,this.sprite.scale=.1,this.sprite.x=-25,this.sprite.y=-25,this.container.addChild(this.gfx),this.container.addChild(this.sprite),this.container.addChild(this.elevationText),this.color=i,this.alpha=n,this.update()}update(){this.updateSprite(),this.updateElevation(),this.updateColor()}updateSprite(){this.woods===1?this.sprite.texture=gt:this.woods===2?this.sprite.texture=we:this.water===!0?this.sprite.texture=wt:this.sprite.texture=zt.EMPTY}updateElevation(){this.elevation>0?this.elevationText.text=`Level ${this.elevation}`:this.elevation<0?this.elevationText.text=`Depth ${Math.abs(this.elevation)}`:this.elevationText.text=""}updateColor(){this.draw(this.color,this.alpha),this.intervening&&(this.defendersChoice?this.draw(16711935,1):this.draw(5592405,1)),this.attacker&&this.draw(10822690,1),this.defender&&this.draw(7707307,1),this.partialCover&&this.draw(255,1),this.inversePartialCover&&this.draw(65280,1),this.dcBlocked&&this.draw(16711680,.5),this.blocked&&this.draw(16711680,1)}draw(t,e){this.gfx.clear().poly(Je()).fill({color:t,alpha:e}).stroke({width:2,color:0})}increaseWoods(){this.water=!1,this.woods?this.woods===1&&(this.woods=2):this.woods=1}addWater(){this.woods=0,this.water=!0}increaseElevation(){this.elevation?this.elevation++:this.elevation=1}decreaseWoods(){this.woods?this.woods>0&&this.woods--:this.woods=0}removeWater(){this.water=!1}decreaseElevation(){this.elevation?this.elevation--:this.elevation=-1}}function ei(o,t){return o.q*t.q+o.r*t.r}function ii(o,t,e){const s=[];s.push(new u(e.hex.q+2/3,e.hex.r-1/3,e.hex.s-1/3)),s.push(new u(e.hex.q+1/3,e.hex.r+1/3,e.hex.s-2/3)),s.push(new u(e.hex.q-1/3,e.hex.r+2/3,e.hex.s-1/3)),s.push(new u(e.hex.q-2/3,e.hex.r+1/3,e.hex.s+1/3)),s.push(new u(e.hex.q-1/3,e.hex.r-1/3,e.hex.s+2/3)),s.push(new u(e.hex.q+1/3,e.hex.r-2/3,e.hex.s+1/3));const i=new u(t.q-o.q,t.r-o.r,t.s-o.s),n=new u(-i.r,i.q,i.r-i.q);let r=0,h=0,a=0;for(const l of s){const p=ei(n,new u(l.q-o.q,l.r-o.r,l.s-o.s)),m=1e-9;p>m&&r++,p<-m&&h++,Math.abs(p)<=m&&a++}return a>1&&(r++,h++,e.defendersChoice=!0),r>0&&h>0}function si(o,t,e){o.forEach(c=>{c.blocked=!1,c.dcBlocked=!1,c.intervening=!1,c.partialCover=!1,c.inversePartialCover=!1,c.defendersChoice=!1});const s=f.hexToPixel(t.hex,_),i=f.hexToPixel(e.hex,_),n=i.x-s.x,r=i.y-s.y,h=n*n+r*r,a=Math.min(t.hex.q,e.hex.q),l=Math.max(t.hex.q,e.hex.q),p=Math.min(t.hex.r,e.hex.r),m=Math.max(t.hex.r,e.hex.r),C=[];for(let c=a;c<=l;c++)for(let v=p;v<=m;v++){const S=-c-v;if(c===t.hex.q&&v===t.hex.r||c===e.hex.q&&v===e.hex.r)continue;const y=o.find(W=>W.hex.q===c&&W.hex.r===v&&W.hex.s===S);y&&ii(t.hex,e.hex,y)&&C.push(y)}C.sort((c,v)=>{const S=f.hexToPixel(c.hex,_),y=f.hexToPixel(v.hex,_),W=((S.x-s.x)*n+(S.y-s.y)*r)/h,M=((y.x-s.x)*n+(y.y-s.y)*r)/h;return W-M});let P=!1;if(C.some(c=>c.defendersChoice)){const c=[],v=[];let S=!1,y=!1,W=0;C.forEach(M=>{W++,W===1&&c.push(M),W===2&&v.push(M),W===3&&(W=0,c.push(M),v.push(M))}),ct(t,e,c)&&(S=!0),ct(t,e,v)&&(y=!0),S&&y?P=!0:(S||y)&&(S&&c.forEach(M=>{M.dcBlocked=!0}),y&&v.forEach(M=>{y&&(M.dcBlocked=!0)}),t.dcBlocked=!0,e.dcBlocked=!0)}else ct(t,e,C)&&(P=!0);C.forEach(c=>{c.blocked=P}),t.blocked=P,e.blocked=P}function ct(o,t,e){const s=Math.max(o.elevation,t.elevation)+2;let i=0,n=!1,r=0;ni(o,t)&&(n=!0),e.length>0&&(e[0].elevation-o.elevation>=2&&(n=!0),e[0].elevation-o.elevation===1&&s<=o.elevation+2&&(o.partialCover=!0),e[e.length-1].elevation-t.elevation>=2&&(n=!0),e[e.length-1].elevation-t.elevation===1&&s<=t.elevation+2&&(t.partialCover=!0));for(const h of e)h.intervening=!0,r++,r>=2&&(r=0,h.defendersChoice=!1),h.elevation>=s&&(n=!0),h.woods&&h.elevation>=s-2&&(i+=h.woods),i>=3&&(n=!0);return n}function ni(o,t){const e=o.elevation<=-2&&o.water,s=o.elevation===-1&&o.water&&!e,i=t.elevation<=-2&&t.water,n=t.elevation===-1&&t.water&&!i;return s&&!t.water&&(o.partialCover=!0),n&&!o.water&&(o.partialCover=!0),s&&i&&(o.inversePartialCover=!0),n&&e&&(t.inversePartialCover=!0),e!=i&&!n&&!s}const L=[],At=41,Rt=40;for(let o=0;o<At;o++){const t=Math.floor(o/2);for(let e=-t;e<Rt-t;e++){const s=-o-e,i=new ti(o,e,s,16777215,0);i.container.interactive=!0,i.container.onpointertap=()=>{if(!xt){if(X.selected===0)if(x.selected===0){const n=L.find(r=>r.defender===!0);n&&(n.defender=!1),i.defender=!0,Y=i}else x.selected===1?i.increaseWoods():x.selected===2?i.addWater():x.selected===3&&i.increaseElevation();if(X.selected===1)if(x.selected===0){const n=L.find(r=>r.attacker===!0);n&&(n.attacker=!1),i.attacker=!0,I=i}else x.selected===1?i.decreaseWoods():x.selected===2?i.removeWater():x.selected===3&&i.decreaseElevation();I&&Y&&si(L,I,Y)}},Z.addChild(i.container),L.push(i)}}const ut={q:20,r:10,s:-30};let I=L.find(o=>o.hex.q===ut.q&&o.hex.r===ut.r&&o.hex.s===ut.s);I&&(I.attacker=!0);const dt={q:NaN,r:NaN,s:NaN};let Y=L.find(o=>o.hex.q===dt.q&&o.hex.r===dt.r&&o.hex.s===dt.s);const Nt=new ht;Z.addChild(Nt);function ri(){I&&Y&&Nt.clear().moveTo(I.x,I.y).lineTo(Y.x,Y.y).stroke({color:0,width:2})}const mt=3/2*_.size.x*(At-1),vt=Math.sqrt(3)*_.size.y*Rt,tt=new Ze({screenWidth:w.screen.width,screenHeight:w.screen.height,worldWidth:mt,worldHeight:vt,events:w.renderer.events});tt.moveCenter({x:mt/2,y:vt/2}).drag().pinch().wheel().clamp({direction:"all"}).clampZoom({minWidth:400,minHeight:400,maxWidth:mt,maxHeight:vt});let xt=!1,nt=null;const oi=50;tt.on("moved",()=>{xt=!0});tt.on("pointerup",()=>{nt!==null&&clearTimeout(nt),nt=window.setTimeout(()=>{xt=!1,nt=null},oi)});w.ticker.maxFPS=30;w.ticker.add(()=>{ri(),L.forEach(o=>{o.update()})});document.body.appendChild(w.canvas);w.stage.addChild(tt);w.stage.addChild(G);w.stage.addChild(J);tt.addChild(Z);
